@using AbraCmsTask.Models
@using Umbraco.Extensions
@inherits Umbraco.Cms.Web.Common.Views.UmbracoViewPage<HomePageViewModel>
@{
    Layout = null;
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Abra Tech Insights</title>
    <style>
        :root {
            --primary: #007bff;
            --primary-hover: #0056b3;
            --bg-gradient: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            --glass: rgba(255, 255, 255, 0.95);
        }

        body { 
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; 
            background: var(--bg-gradient);
            background-attachment: fixed;
            margin: 0;
            padding: 40px 20px;
            color: #333;
            min-height: 100vh;
        }

        .main-container {
            max-width: 900px;
            margin: 0 auto;
            background: var(--glass);
            padding: 40px;
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        header { text-align: center; margin-bottom: 40px; }
        header h1 { font-size: 2.5rem; margin-bottom: 10px; color: #1a1a1a; }
        header p { color: #666; font-size: 1.1rem; }

        .category-nav { 
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin-bottom: 30px;
        }

        .category-link { 
            text-decoration: none; 
            padding: 8px 18px; 
            border-radius: 50px; 
            background: #fff; 
            color: #555; 
            font-size: 0.9em; 
            font-weight: 500;
            border: 1px solid #ddd;
            transition: all 0.2s ease;
        }

        .category-link:hover { 
            border-color: var(--primary);
            color: var(--primary);
        }

        .active-cat { 
            background: var(--primary) !important; 
            color: white !important; 
            border-color: var(--primary) !important;
            box-shadow: 0 4px 12px rgba(0,123,255,0.3);
        }

        .search-box {
            display: flex;
            gap: 10px;
            margin-bottom: 40px;
            justify-content: center;
        }

        .search-box input { 
            padding: 12px 20px; 
            width: 100%;
            max-width: 400px; 
            border: 2px solid #eee; 
            border-radius: 8px; 
            font-size: 1rem;
            outline: none;
            transition: border-color 0.2s;
        }

        .search-box input:focus { border-color: var(--primary); }

        .search-box button { 
            padding: 12px 25px; 
            background: var(--primary); 
            color: white; 
            border: none; 
            border-radius: 8px; 
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
        }

        .search-box button:hover { background: var(--primary-hover); }

        .article-card { 
            background: #fff;
            border: 1px solid #eee; 
            padding: 25px; 
            margin-top: 20px; 
            border-radius: 12px; 
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .article-card:hover { 
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            border-color: #d1d9e6;
        }

        .article-card h3 { margin: 0 0 10px 0; font-size: 1.4rem; }
        .article-card h3 a { text-decoration: none; color: #1a1a1a; }
        .article-card h3 a:hover { color: var(--primary); }

        .tag { 
            background: #eef2ff; 
            color: #4f46e5;
            padding: 4px 12px; 
            border-radius: 6px; 
            font-size: 0.75em; 
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .author { font-size: 0.9rem; color: #777; margin-left: 10px; }

        .article-preview { 
            color: #555; 
            margin: 15px 0; 
            font-size: 1rem;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .read-more {
            display: inline-block;
            margin-top: 10px;
            color: var(--primary);
            font-weight: 600;
            text-decoration: none;
            font-size: 0.95rem;
        }

        .no-results {
            text-align: center;
            padding: 40px;
            background: #fffbe6;
            border-radius: 8px;
            color: #856404;
        }
    </style>
</head>
<body>

<div class="main-container">
    <header>
        <h1>@Model.Content.Value("siteTitle")</h1>
        <p>@Model.Content.Value("siteDescription")</p>
    </header>

    <nav class="category-nav">
        <a href="/" class="category-link @(string.IsNullOrEmpty(Model.SelectedCategory) ? "active-cat" : "")">All Articles</a>
        <a href="/?category=Technology" class="category-link @(Model.SelectedCategory == "Technology" ? "active-cat" : "")">Technology</a>
        <a href="/?category=Game Development" class="category-link @(Model.SelectedCategory == "Game Development" ? "active-cat" : "")">Game Development</a>
        <a href="/?category=Health" class="category-link @(Model.SelectedCategory == "Health" ? "active-cat" : "")">Health</a>
        <a href="/?category=Sports" class="category-link @(Model.SelectedCategory == "Sports" ? "active-cat" : "")">Sports</a>
    </nav>

    <form method="get" class="search-box">
        <input type="text" name="query" value="@Model.Query" placeholder="What are you looking for?" />
        @if (!string.IsNullOrEmpty(Model.SelectedCategory))
        {
            <input type="hidden" name="category" value="@Model.SelectedCategory" />
        }
        <button type="submit">Search</button>
    </form>

    <div class="article-list">
        @if (Model.SearchResults != null && Model.SearchResults.Any())
        {
            foreach (var item in Model.SearchResults)
            {
                <article class="article-card">
                    <span class="tag">@item.Value("category")</span>
                    <span class="author">by @item.Value("authorName")</span>
                    
                    <h3><a href="@item.Url()">@item.Name</a></h3>

                    <div class="article-preview">
                        @{
                            var rawContent = item.Value<string>("articleContent") ?? string.Empty;
                            var stripped = rawContent.StripHtml().ToString();
                            var preview = stripped.Length > 180 ? stripped.Substring(0, 180) + "..." : stripped;
                        }
                        @preview
                    </div>
                    
                    <a href="@item.Url()" class="read-more">Read full story →</a>
                </article>
            }
        }
        else
        {
            <div class="no-results">
                <strong>No matches found.</strong> Try adjusting your search or selecting a different category.
            </div>
        }
    </div>
</div>

</body>
</html>